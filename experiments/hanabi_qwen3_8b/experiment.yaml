schema_version: 1
name: hanabi_qwen3_8b
kind: rollout_eval
description: Hanabi rollout eval with two Qwen3-8B agents (vLLM local).
tags: ["eval", "rollout", "hanabi", "qwen3"]

repro:
  seed: 0
  python: ">=3.10,<3.13"

spec:
  env_id: "Hanabi-v0-train"
  env_kwargs: null
  run_tag: null
  num_players: 2
  episodes: 2
  agents:
    - "qwen:Qwen/Qwen3-8B"
    - "qwen:Qwen/Qwen3-8B"
  system_prompt: |-
    You are playing a text-based game.
    Read the observation carefully and follow all rules.
    Output EXACTLY ONE valid action in the required format, and NOTHING else.
    Do NOT output reasoning, explanations, multiple actions, or extra lines.
  openai_base_url: "http://localhost:8000/v1"
  openai_api_key: "dummy"
  timeout_s: null
  gen:
    temperature: 0.6
    top_p: 0.95
    top_k: 20
    repetition_penalty: null
    presence_penalty: null
    frequency_penalty: null
    gen_seed: null
    max_tokens: null
    extra_body:
      min_p: 0.0
    chat_template_kwargs:
      enable_thinking: true
    disable_thinking: false

commands:
  - >-
    python tools/rollout/run_rollouts.py
    --env-id {spec.env_id}
    {optsh:--env-kwargs spec.env_kwargs}
    --num-players {spec.num_players}
    --episodes {spec.episodes}
    --seed {repro.seed}
    {agent_flags}
    --system-prompt {sh:spec.system_prompt}
    {opt:--openai-base-url spec.openai_base_url}
    {opt:--openai-api-key spec.openai_api_key}
    {opt:--timeout spec.timeout_s}
    {opt:--temperature spec.gen.temperature}
    {opt:--top-p spec.gen.top_p}
    {opt:--top-k spec.gen.top_k}
    {opt:--repetition-penalty spec.gen.repetition_penalty}
    {opt:--presence-penalty spec.gen.presence_penalty}
    {opt:--frequency-penalty spec.gen.frequency_penalty}
    {opt:--gen-seed spec.gen.gen_seed}
    {optsh:--extra-body spec.gen.extra_body}
    {optsh:--chat-template-kwargs spec.gen.chat_template_kwargs}
    {flag:--disable-thinking spec.gen.disable_thinking}
    {opt:--max-tokens spec.gen.max_tokens}
    --episode-json-dir {run_dir}/episodes
    --out {run_dir}/rollouts.jsonl
  - >-
    python tools/rollout/summarize_rollouts.py {run_dir}/rollouts.jsonl
    --json > {run_dir}/summary.json

outputs:
  files:
    - "{run_dir}/rollouts.jsonl"
    - "{run_dir}/summary.json"

wandb:
  project: "mindgames"
  job_type: "eval"
